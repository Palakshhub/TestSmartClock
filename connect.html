<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Clock Controller</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2300AAFF' d='M12 18c1.104 0 2-.896 2-2s-.896-2-2-2-2 .896-2 2 .896 2 2 2zm0-5c3.314 0 6 2.686 6 6h-2c0-2.209-1.791-4-4-4s-4 1.791-4 4H6c0-3.314 2.686-6 6-6zm0-5c5.523 0 10 4.477 10 10h-2c0-4.418-3.582-8-8-8s-8 3.582-8 8H2c0-5.523 4.477-10 10-10z'/%3E%3C/svg%3E" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html, body { font-family: 'Inter', sans-serif; height:100%; width:100%; margin:0; }
  .card { background-color: rgba(255,255,255,0.98); border-radius:0.75rem; padding:1rem; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1); }
  .hidden { display:none; }
  button { cursor:pointer; }
</style>
</head>
<body class="flex flex-col items-center justify-start p-4">

<h1 class="text-3xl font-bold mb-4">Smart Clock Controller</h1>
<p class="mb-6 text-gray-600">Connect to your ESP32 and send commands.</p>

<!-- Connect Button -->
<button id="connectBtn" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded mb-6">ðŸ”Œ Connect ESP32</button>

<!-- Command Buttons -->
<div class="flex flex-col gap-3 w-full max-w-md">
  <button id="recordBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded">ðŸŽ™ Record</button>
  <button id="typeBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded">âŒ¨ Type</button>
</div>

<!-- Record Section -->
<div id="recordSection" class="hidden w-full max-w-md mt-4">
  <div id="voiceResult" class="card hidden">
    <div id="voiceText" class="mb-3 text-gray-700"></div>
    <button id="sendVoiceBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded w-full">Send to ESP32</button>
  </div>
</div>

<!-- Type Section -->
<div id="typeSection" class="hidden w-full max-w-md mt-4">
  <div class="card">
    <textarea id="typeInput" class="w-full border rounded p-2 mb-3 resize-none" rows="3" placeholder="Type your command here..."></textarea>
    <button id="sendTextBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded w-full">Send to ESP32</button>
  </div>
</div>

<script>
let bluetoothDevice;
let txCharacteristic;
const SERVICE_UUID = "12345678-1234-5678-1234-56789abcdef0";
const CHARACTERISTIC_UUID = "abcdef01-1234-5678-1234-56789abcdef0";

// Connect ESP32
document.getElementById('connectBtn').addEventListener('click', async () => {
  try {
    bluetoothDevice = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: "BluScreen" }],
      optionalServices: [SERVICE_UUID]
    });
    const server = await bluetoothDevice.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    txCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
    alert("âœ… Connected to ESP32!");
  } catch (err) {
    alert("âš  Could not connect: " + err);
  }
});

// Send command helper
async function sendCommand(command) {
  if (!txCharacteristic) {
    alert("âš  Not connected. Click 'Connect ESP32' first.");
    return;
  }
  try {
    const encoder = new TextEncoder();
    await txCharacteristic.writeValue(encoder.encode(command));
    alert("ðŸ“¤ Sent: " + command);
  } catch (err) {
    alert("âš  Failed to send: " + err);
  }
}

// Type and Voice buttons
document.getElementById('recordBtn').addEventListener('click', () => {
  document.getElementById('recordSection').classList.remove('hidden');
  document.getElementById('typeSection').classList.add('hidden');
});

document.getElementById('typeBtn').addEventListener('click', () => {
  document.getElementById('typeSection').classList.remove('hidden');
  document.getElementById('recordSection').classList.add('hidden');
});

document.getElementById('sendTextBtn').addEventListener('click', () => {
  const cmd = document.getElementById('typeInput').value.trim();
  if(cmd) sendCommand(cmd);
});

// Optional: basic speech recognition
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if(SpeechRecognition){
  const recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = true;
  recognition.lang = 'en-US';

  recognition.onresult = (event) => {
    const transcript = Array.from(event.results).map(r=>r[0].transcript).join('');
    document.getElementById('voiceText').textContent = transcript;
    document.getElementById('voiceResult').classList.remove('hidden');
  };

  document.getElementById('sendVoiceBtn').addEventListener('click', () => {
    const cmd = document.getElementById('voiceText').textContent.trim();
    if(cmd) sendCommand(cmd);
  });

  document.getElementById('recordBtn').addEventListener('click', () => recognition.start());
} else {
  document.getElementById('recordBtn').disabled = true;
  document.getElementById('recordBtn').textContent = 'Voice Not Supported';
}
</script>
</body>
</html>
